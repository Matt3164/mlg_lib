---

title: How to train a Rocket-like classifier
keywords: fastai
sidebar: home_sidebar

summary: "Details"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/22_application.rocket.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="k">import</span> <span class="n">fetch_openml</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">train_test_split</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">fetch_openml</span><span class="p">(</span><span class="s2">&quot;Fashion-MNIST&quot;</span><span class="p">,</span> <span class="n">data_home</span><span class="o">=</span><span class="s2">&quot;/home/matthieu/sklearn_data&quot;</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>

<span class="n">xtrain</span><span class="p">,</span> <span class="n">xtest</span><span class="p">,</span> <span class="n">ytrain</span><span class="p">,</span> <span class="n">ytest</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 21.8 s, sys: 1.14 s, total: 22.9 s
Wall time: 22.8 s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="k">import</span> <span class="n">ExtraTreesClassifier</span>
<span class="kn">from</span> <span class="nn">mlg_lib.imgfeat</span> <span class="k">import</span> <span class="n">ConvolutionFeature</span>
<span class="kn">from</span> <span class="nn">mlg_lib.ml_utils</span> <span class="k">import</span> <span class="n">make_single_feature_model</span><span class="p">,</span> <span class="n">sk_train</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kernel</span> <span class="o">=</span> <span class="mf">0.2</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1024</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">make_single_feature_model</span><span class="p">(</span>
    <span class="n">ConvolutionFeature</span><span class="p">(</span><span class="n">kernel</span><span class="p">),</span>
    <span class="n">ExtraTreesClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="s2">&quot;log2&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">sk_train</span><span class="p">(</span><span class="n">xtrain</span><span class="p">,</span> <span class="n">xtest</span><span class="p">,</span> <span class="n">ytrain</span><span class="p">,</span> <span class="n">ytest</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">cm</span><span class="o">=</span><span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">acc</span><span class="o">=</span><span class="n">accuracy_score</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 42min 42s, sys: 1.08 s, total: 42min 43s
Wall time: 42min 43s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">out</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>TrainingOutput(model=Pipeline(memory=None,
         steps=[(&#39;lambdarow&#39;,
                 LambdaRow(row_func=ConvolutionFeature(kernel=array([[[-0.01862784,  0.14068661, -0.1179006 , ...,  0.16931905,
          0.07983808, -0.19455821],
        [ 0.20751521,  0.28199082, -0.31899427, ..., -0.180693  ,
         -0.00451666, -0.18769505],
        [ 0.08511326, -0.1607457 , -0.17425808, ..., -0.07164706,
          0.0883254 ,  0.50614893]],

       [[-0.40805935,  0.01590126, -0.150945...
                 ExtraTreesClassifier(bootstrap=False, class_weight=None,
                                      criterion=&#39;gini&#39;, max_depth=None,
                                      max_features=&#39;log2&#39;, max_leaf_nodes=None,
                                      min_impurity_decrease=0.0,
                                      min_impurity_split=None,
                                      min_samples_leaf=1, min_samples_split=2,
                                      min_weight_fraction_leaf=0.0,
                                      n_estimators=100, n_jobs=None,
                                      oob_score=False, random_state=None,
                                      verbose=0, warm_start=False))],
         verbose=False), metrics={&#39;train_cm&#39;: array([[6019,    0,    0,    0,    0,    0,    0,    0,    0,    0],
       [   0, 5964,    0,    0,    0,    0,    0,    0,    0,    0],
       [   0,    0, 5955,    0,    0,    0,    0,    0,    0,    0],
       [   0,    0,    0, 5988,    0,    0,    0,    0,    0,    0],
       [   0,    0,    0,    0, 6028,    0,    0,    0,    0,    0],
       [   0,    0,    0,    0,    0, 6007,    0,    0,    0,    0],
       [   0,    0,    0,    0,    0,    0, 6009,    0,    0,    0],
       [   0,    0,    0,    0,    0,    0,    0, 6003,    0,    0],
       [   0,    0,    0,    0,    0,    0,    0,    0, 6004,    0],
       [   0,    0,    0,    0,    0,    0,    0,    0,    0, 6023]]), &#39;train_acc&#39;: 1.0, &#39;test_cm&#39;: array([[731,   3,  21,  84,  33,   2,  76,   0,  31,   0],
       [  9, 972,  16,  36,   1,   0,   2,   0,   0,   0],
       [ 18,   0, 801,  13, 127,   1,  73,   0,  12,   0],
       [ 40,   7,  25, 863,  42,   2,  24,   0,   9,   0],
       [ 19,   0,  87,  87, 673,   0,  90,   0,  14,   2],
       [  0,   0,   0,   0,   0, 881,   0,  81,   3,  28],
       [198,   1,  91,  52, 127,   1, 484,   0,  37,   0],
       [  0,   0,   0,   0,   0,  55,   0, 884,   0,  58],
       [ 11,   0,   3,  16,   2,  12,   9,   4, 930,   9],
       [  4,   0,   0,   0,   1,  11,   0,  50,   9, 902]]), &#39;test_acc&#39;: 0.8121})</pre>
</div>

</div>

</div>
</div>

</div>
</div>
 

